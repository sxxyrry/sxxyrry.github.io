<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>下载文件</title>
    <link rel="stylesheet" href="/css.css">
</head>
<body>
    <h1 id="text1">文件下载 - ""</h1>

    <p id="text2">正在下载 - ""</p>

    <button id="btn1">下载失败点击</button>

    <script type="module">
        import Files from "./Files.js"
        function main(){
            const btn = document.getElementById("btn1");
            // 获取当前页面的URL
            const urlParams = new URLSearchParams(window.location.search);

            // 获取特定参数的值
            // const paramValue = urlParams.get('参数名');
            var FileName = ''
            try{
                var FileName = decodeURIComponent(atob(urlParams.get('RmlsZU5hbWU'))); // 解码文件名
            } catch (error) {
                if (error instanceof InvalidCharacterError) {
                    window.top.document.title = `下载文件 - 不存在`;
                    document.getElementById("text1").innerHTML = `文件不存在，无法下载。`;
                    document.getElementById("text2").innerHTML = `文件不存在，无法下载。`;
                    btn.remove(); // 销毁这个按钮
                    
                    return;
                }
                throw error;
            }

            if (FileName == null || Files.includes(FileName) === false){
                window.top.document.title = `下载文件 - 不存在`;
                document.getElementById("text1").innerHTML = `文件不存在，无法下载。`;
                document.getElementById("text2").innerHTML = `文件不存在，无法下载。`;
                btn.remove(); // 销毁这个按钮
            } else {
                window.top.document.title = `下载文件 - "${FileName}"`;
                document.getElementById("text1").innerHTML = `文件下载 - "${FileName}"`;
                document.getElementById("text2").innerHTML = `正在下载 - "${FileName}"`;
                btn.addEventListener("click", () => {
                    let a = document.createElement("a");
                    a.href = `./Files/${FileName}`;
                    a.download = FileName;
                    a.click();
                })
                let a = document.createElement("a");
                a.href = `./Files/${FileName}`;
                a.download = FileName;
                a.click();
            }
        }

        main();
    </script>

</body>
</html>