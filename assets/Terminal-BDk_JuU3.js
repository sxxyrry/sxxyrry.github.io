import{a as T,_ as I}from"./index-3XFZ_c5Q.js";import{d as R,r as i,o as B,g as E,c,f as j,a as y,F,i as L,z as O,t as h,A as U,B as g,h as S,x as V,b as r,C as K}from"./ElseDependent-Q8CVMjsT.js";const q={class:"terminal-container"},z={class:"terminal-content"},M={key:0,class:"command-line"},N={class:"prompt"},X={key:1,class:"input-line"},H={key:2,class:"output-line"},W={class:"input-line"},Z={key:0,class:"prompt"},G={key:1,class:"prompt"},J=R({__name:"Terminal",setup(Q){const e=i([{type:"output",text:"欢迎使用终端模拟器"},{type:"output",text:"输入 help 查看可用命令"}]);V();const n=i(""),v=i([]),p=i(-1),f=i(null),x=i(null),_=i(`user_${Math.random().toString(16).substring(2,8)}`);let s=null;const d=i({}),o=i({isActive:!1,filename:"",content:[]}),k=async()=>{try{if(!s){e.value.push({type:"output",text:"正在加载 Pyodide..."});const{loadPyodide:t}=await T(async()=>{const{loadPyodide:a}=await import("pyodide");return{loadPyodide:a}},[]);s=await t(),e.value.push({type:"output",text:"Pyodide 加载完成"})}return s}catch(t){return e.value.push({type:"output",text:`Pyodide 加载失败: ${t.message||t}`}),null}},w={help:()=>{e.value.push({type:"output",text:`可用命令: 
    help
    clear
    echo
    date
    whoami
    time
    date-time
    SigmaCloudStorage [filename]
    python [code|--file filename]
    createFile [filename]
    cat [filename]
    ls

`})},clear:()=>{e.value=[]},echo:t=>{e.value.push({type:"output",text:t.join(" ")})},date:()=>{e.value.push({type:"output",text:new Date().toLocaleDateString()})},time:()=>{e.value.push({type:"output",text:new Date().toLocaleTimeString()})},"date-time":()=>{e.value.push({type:"output",text:new Date().toLocaleString()})},whoami:()=>{e.value.push({type:"output",text:_.value})},SigmaCloudStorage:t=>{const a=t.join(" ");if(!a){e.value.push({type:"output",text:"错误: 请提供文件名"});return}try{let l="/SigmaCloudStorage/Download.html?RmlsZU5hbWU="+btoa(encodeURIComponent(a));window.open(l,"_blank"),e.value.push({type:"output",text:`已为文件 "${a}" 打开下载页面`})}catch(u){e.value.push({type:"output",text:`错误: ${u.message||u}`})}},python:async t=>{const a=t.indexOf("--file");if(a!==-1&&a+1<t.length){const l=t[a+1];if(d.value[l]){const m=d.value[l];await b(m)}else e.value.push({type:"output",text:`错误: 文件 "${l}" 不存在`});return}const u=t.join(" ");if(!u.trim()){e.value.push({type:"output",text:""});return}await b(u)},createFile:t=>{if(t.length<1){e.value.push({type:"output",text:"用法: createFile [filename]"});return}const a=t[0];o.value={isActive:!0,filename:a,content:[]},e.value.push({type:"output",text:`正在创建文件 "${a}"，输入内容（输入 :wq 保存并退出）：`})},cat:t=>{if(t.length<1){e.value.push({type:"output",text:"用法: cat [filename]"});return}const a=t[0];d.value[a]?e.value.push({type:"output",text:d.value[a]}):e.value.push({type:"output",text:`错误: 文件 "${a}" 不存在`})},ls:()=>{const t=Object.keys(d.value);t.length===0?e.value.push({type:"output",text:"没有文件"}):e.value.push({type:"output",text:`文件列表:
`+t.join(`
`)})}},b=async t=>{if(!t.trim()){e.value.push({type:"output",text:""});return}const a=await k();if(!a){e.value.push({type:"output",text:"Pyodide 未正确加载"});return}try{const u=e.value.length;e.value.push({type:"output",text:"执行中..."});let l=[];s&&s.setStdout({write:m=>{const D=new TextDecoder().decode(m);return l.push({type:"output",text:D}),m.length}}),await a.runPythonAsync(t),e.value.pop(),l.forEach(m=>{e.value.push(m)}),e.value.push({type:"output",text:"执行完成"}),s&&s.setStdout(void 0)}catch(u){e.value.push({type:"output",text:`Python 错误: ${u.message||u}`}),s&&s.setStdout(void 0)}},$=()=>{if(o.value.isActive){if(n.value===":wq"||n.value===":w"||n.value===":q"){const u=o.value.filename,l=o.value.content.join(`
`);d.value[u]=l,e.value.push({type:"output",text:`文件 "${u}" 已创建，共 ${o.value.content.length} 行`}),o.value={isActive:!1,filename:"",content:[]},n.value="";return}o.value.content.push(n.value),e.value.push({type:"input",text:n.value}),n.value="";return}if(n.value.trim()==="")return;e.value.push({type:"command",text:n.value}),v.value.push(n.value),p.value=v.value.length;const[t,...a]=n.value.trim().split(" ");w[t]?w[t](a):t&&e.value.push({type:"output",text:`命令未找到: ${t}`}),n.value="",K(()=>{f.value&&(f.value.scrollTop=f.value.scrollHeight)})},A=()=>{o.value.isActive||v.value.length!==0&&(p.value>0&&p.value--,n.value=v.value[p.value]||"")},C=()=>{o.value.isActive||(p.value<v.value.length-1?(p.value++,n.value=v.value[p.value]):(p.value=v.value.length,n.value=""))},P=t=>{if(o.value.isActive&&t.ctrlKey&&t.key==="c"){t.preventDefault();const a=o.value.filename,u=o.value.content.join(`
`);d.value[a]=u,e.value.push({type:"output",text:`^C
文件 "${a}" 已创建，共 ${o.value.content.length} 行`}),o.value={isActive:!1,filename:"",content:[]},n.value=""}};return B(()=>{setTimeout(()=>{x.value&&x.value.focus()},200),document.addEventListener("keydown",P);const t=document.getElementById("cursor");t&&t.animate([{display:"none"}],{duration:0,fill:"forwards"})}),E(()=>{const t=document.getElementById("cursor");t&&t.getAnimations().forEach(a=>{a.cancel()})}),(t,a)=>(r(),c("div",q,[a[2]||(a[2]=j('<div class="terminal-header" data-v-e5271bdd><div class="terminal-buttons" data-v-e5271bdd><button class="button close" data-v-e5271bdd>o</button><button class="button minimize" data-v-e5271bdd>o</button><button class="button maximize" data-v-e5271bdd>o</button></div><div class="terminal-title" data-v-e5271bdd>终端_23XR</div></div>',1)),y("div",{class:"terminal-body",ref_key:"terminalBody",ref:f},[y("div",z,[(r(!0),c(F,null,L(e.value,(u,l)=>(r(),c("div",{key:l,class:"output-line"},[u.type==="command"?(r(),c("span",M,[y("span",N,h(_.value)+"@23XR_System:~$",1),S(h(u.text),1)])):u.type==="input"?(r(),c("span",X,[a[1]||(a[1]=y("span",{class:"prompt"},"... > ",-1)),S(h(u.text),1)])):(r(),c("span",H,h(u.text),1))]))),128)),y("div",W,[o.value.isActive?(r(),c("span",Z,"... > ")):(r(),c("span",G,h(_.value)+"@23XR_System:~$",1)),O(y("input",{ref_key:"inputRef",ref:x,"onUpdate:modelValue":a[0]||(a[0]=u=>n.value=u),onKeyup:[g($,["enter"]),g(A,["up"]),g(C,["down"])],type:"text",class:"terminal-input",autofocus:""},null,544),[[U,n.value]])])])],512)]))}}),et=I(J,[["__scopeId","data-v-e5271bdd"]]);export{et as default};
