import{d as j,r as i,o as R,g as B,c,f as I,a as y,F as E,i as F,z as L,t as h,A as U,B as w,h as S,x as K,b as r,C as N}from"./ElseDependent-Q8CVMjsT.js";import{_ as O}from"./index-CEUacyVH.js";const V={class:"terminal-container"},q={class:"terminal-content"},z={key:0,class:"command-line"},M={class:"prompt"},X={key:1,class:"input-line"},H={key:2,class:"output-line"},W={class:"input-line"},Z={key:0,class:"prompt"},G={key:1,class:"prompt"},J=j({__name:"Terminal",setup(Q){const u=i([{type:"output",text:"欢迎使用终端模拟器"},{type:"output",text:"输入 help 查看可用命令"}]);K();const n=i(""),v=i([]),p=i(-1),f=i(null),x=i(null),_=i(`user_${Math.random().toString(16).substring(2,8)}`);let s=null;const d=i({}),o=i({isActive:!1,filename:"",content:[]}),k=()=>{let e="https://cdn.jsdelivr.net/pyodide/v0.28.2/full/pyodide.js",t=document.createElement("script");t.src=e,t.async=!0,document.body.appendChild(t)},C=async()=>{try{return s||(u.value.push({type:"output",text:"正在加载 Pyodide..."}),k(),await new Promise(e=>{const t=()=>{window.loadPyodide?e(!0):setTimeout(t,100)};t()}),s=await window.loadPyodide(),u.value.push({type:"output",text:"Pyodide 加载完成"})),s}catch(e){return u.value.push({type:"output",text:`Pyodide 加载失败: ${e.message||e}`}),null}},g={help:()=>{u.value.push({type:"output",text:`可用命令: 
    help
    clear
    echo
    date
    whoami
    time
    date-time
    SigmaCloudStorage [filename]
    python [code|--file filename]
    createFile [filename]
    cat [filename]
    ls

`})},clear:()=>{u.value=[]},echo:e=>{u.value.push({type:"output",text:e.join(" ")})},date:()=>{u.value.push({type:"output",text:new Date().toLocaleDateString()})},time:()=>{u.value.push({type:"output",text:new Date().toLocaleTimeString()})},"date-time":()=>{u.value.push({type:"output",text:new Date().toLocaleString()})},whoami:()=>{u.value.push({type:"output",text:_.value})},SigmaCloudStorage:e=>{const t=e.join(" ");if(!t){u.value.push({type:"output",text:"错误: 请提供文件名"});return}try{let l="/SigmaCloudStorage/Download.html?RmlsZU5hbWU="+btoa(encodeURIComponent(t));window.open(l,"_blank"),u.value.push({type:"output",text:`已为文件 "${t}" 打开下载页面`})}catch(a){u.value.push({type:"output",text:`错误: ${a.message||a}`})}},python:async e=>{const t=e.indexOf("--file");if(t!==-1&&t+1<e.length){const l=e[t+1];if(d.value[l]){const m=d.value[l];await b(m)}else u.value.push({type:"output",text:`错误: 文件 "${l}" 不存在`});return}const a=e.join(" ");if(!a.trim()){u.value.push({type:"output",text:""});return}await b(a)},createFile:e=>{if(e.length<1){u.value.push({type:"output",text:"用法: createFile [filename]"});return}const t=e[0];o.value={isActive:!0,filename:t,content:[]},u.value.push({type:"output",text:`正在创建文件 "${t}"，输入内容（输入 :wq 保存并退出）：`})},cat:e=>{if(e.length<1){u.value.push({type:"output",text:"用法: cat [filename]"});return}const t=e[0];d.value[t]?u.value.push({type:"output",text:d.value[t]}):u.value.push({type:"output",text:`错误: 文件 "${t}" 不存在`})},ls:()=>{const e=Object.keys(d.value);e.length===0?u.value.push({type:"output",text:"没有文件"}):u.value.push({type:"output",text:`文件列表:
`+e.join(`
`)})}},b=async e=>{if(!e.trim()){u.value.push({type:"output",text:""});return}const t=await C();if(!t){u.value.push({type:"output",text:"Pyodide 未正确加载"});return}try{const a=u.value.length;u.value.push({type:"output",text:"执行中..."});let l=[];s&&s.setStdout({write:m=>{const T=new TextDecoder().decode(m);return l.push({type:"output",text:T}),m.length}}),await t.runPythonAsync(e),u.value.pop(),l.forEach(m=>{u.value.push(m)}),u.value.push({type:"output",text:"执行完成"}),s&&s.setStdout(void 0)}catch(a){u.value.push({type:"output",text:`Python 错误: ${a.message||a}`}),s&&s.setStdout(void 0)}},$=()=>{if(o.value.isActive){if(n.value===":wq"||n.value===":w"||n.value===":q"){const a=o.value.filename,l=o.value.content.join(`
`);d.value[a]=l,u.value.push({type:"output",text:`文件 "${a}" 已创建，共 ${o.value.content.length} 行`}),o.value={isActive:!1,filename:"",content:[]},n.value="";return}o.value.content.push(n.value),u.value.push({type:"input",text:n.value}),n.value="";return}if(n.value.trim()==="")return;u.value.push({type:"command",text:n.value}),v.value.push(n.value),p.value=v.value.length;const[e,...t]=n.value.trim().split(" ");g[e]?g[e](t):e&&u.value.push({type:"output",text:`命令未找到: ${e}`}),n.value="",N(()=>{f.value&&(f.value.scrollTop=f.value.scrollHeight)})},A=()=>{o.value.isActive||v.value.length!==0&&(p.value>0&&p.value--,n.value=v.value[p.value]||"")},P=()=>{o.value.isActive||(p.value<v.value.length-1?(p.value++,n.value=v.value[p.value]):(p.value=v.value.length,n.value=""))},D=e=>{if(o.value.isActive&&e.ctrlKey&&e.key==="c"){e.preventDefault();const t=o.value.filename,a=o.value.content.join(`
`);d.value[t]=a,u.value.push({type:"output",text:`^C
文件 "${t}" 已创建，共 ${o.value.content.length} 行`}),o.value={isActive:!1,filename:"",content:[]},n.value=""}};return R(()=>{setTimeout(()=>{x.value&&x.value.focus()},200),document.addEventListener("keydown",D);const e=document.getElementById("cursor");e&&e.animate([{display:"none"}],{duration:0,fill:"forwards"})}),B(()=>{const e=document.getElementById("cursor");e&&e.getAnimations().forEach(t=>{t.cancel()})}),(e,t)=>(r(),c("div",V,[t[2]||(t[2]=I('<div class="terminal-header" data-v-02e942e4><div class="terminal-buttons" data-v-02e942e4><button class="button close" data-v-02e942e4>o</button><button class="button minimize" data-v-02e942e4>o</button><button class="button maximize" data-v-02e942e4>o</button></div><div class="terminal-title" data-v-02e942e4>终端_23XR</div></div>',1)),y("div",{class:"terminal-body",ref_key:"terminalBody",ref:f},[y("div",q,[(r(!0),c(E,null,F(u.value,(a,l)=>(r(),c("div",{key:l,class:"output-line"},[a.type==="command"?(r(),c("span",z,[y("span",M,h(_.value)+"@23XR_System:~$",1),S(h(a.text),1)])):a.type==="input"?(r(),c("span",X,[t[1]||(t[1]=y("span",{class:"prompt"},"... > ",-1)),S(h(a.text),1)])):(r(),c("span",H,h(a.text),1))]))),128)),y("div",W,[o.value.isActive?(r(),c("span",Z,"... > ")):(r(),c("span",G,h(_.value)+"@23XR_System:~$",1)),L(y("input",{ref_key:"inputRef",ref:x,"onUpdate:modelValue":t[0]||(t[0]=a=>n.value=a),onKeyup:[w($,["enter"]),w(A,["up"]),w(P,["down"])],type:"text",class:"terminal-input",autofocus:""},null,544),[[U,n.value]])])])],512)]))}}),te=O(J,[["__scopeId","data-v-02e942e4"]]);export{te as default};
